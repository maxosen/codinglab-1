{% load static %}

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coding Lab | Exercise</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/layout.css' %}">
  <link rel="stylesheet" href="{% static 'css/tutorial_dir.css' %}">
</head>
<body>
<!-- S I D E   N A V I G A T I O N -->
<div class="sidenav">
  <div class="sidenav-link">
    <div class="navi-icon">
      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"></path></svg>
    </div>
    <a href="{% url 'account' %}"></a>Account</a>
  </div>

  <div class="sidenav-link active">
    <a href="{% url 'classes' %}">
      <div class="navi-icon"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M208 352c-2.39 0-4.78.35-7.06 1.09C187.98 357.3 174.35 360 160 360c-14.35 0-27.98-2.7-40.95-6.91-2.28-.74-4.66-1.09-7.05-1.09C49.94 352-.33 402.48 0 464.62.14 490.88 21.73 512 48 512h224c26.27 0 47.86-21.12 48-47.38.33-62.14-49.94-112.62-112-112.62zm-48-32c53.02 0 96-42.98 96-96s-42.98-96-96-96-96 42.98-96 96 42.98 96 96 96zM592 0H208c-26.47 0-48 22.25-48 49.59V96c23.42 0 45.1 6.78 64 17.8V64h352v288h-64v-64H384v64h-76.24c19.1 16.69 33.12 38.73 39.69 64H592c26.47 0 48-22.25 48-49.59V49.59C640 22.25 618.47 0 592 0z"></path></svg></div>
      My Classes
    </a>
  </div>

  <div class="sidenav-link">
    <a href="{% url 'logout' %}">
      <div class="navi-icon">
        <svg height="1em" width="1em" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512.00533 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m320 277.335938c-11.796875 0-21.332031 9.558593-21.332031 21.332031v85.335937c0 11.753906-9.558594 21.332032-21.335938 21.332032h-64v-320c0-18.21875-11.605469-34.496094-29.054687-40.554688l-6.316406-2.113281h99.371093c11.777344 0 21.335938 9.578125 21.335938 21.335937v64c0 11.773438 9.535156 21.332032 21.332031 21.332032s21.332031-9.558594 21.332031-21.332032v-64c0-35.285156-28.714843-63.99999975-64-63.99999975h-229.332031c-.8125 0-1.492188.36328175-2.28125.46874975-1.027344-.085937-2.007812-.46874975-3.050781-.46874975-23.53125 0-42.667969 19.13281275-42.667969 42.66406275v384c0 18.21875 11.605469 34.496093 29.054688 40.554687l128.386718 42.796875c4.351563 1.34375 8.679688 1.984375 13.226563 1.984375 23.53125 0 42.664062-19.136718 42.664062-42.667968v-21.332032h64c35.285157 0 64-28.714844 64-64v-85.335937c0-11.773438-9.535156-21.332031-21.332031-21.332031zm0 0"/><path d="m505.75 198.253906-85.335938-85.332031c-6.097656-6.101563-15.273437-7.9375-23.25-4.632813-7.957031 3.308594-13.164062 11.09375-13.164062 19.714844v64h-85.332031c-11.777344 0-21.335938 9.554688-21.335938 21.332032 0 11.777343 9.558594 21.332031 21.335938 21.332031h85.332031v64c0 8.621093 5.207031 16.40625 13.164062 19.714843 7.976563 3.304688 17.152344 1.46875 23.25-4.628906l85.335938-85.335937c8.339844-8.339844 8.339844-21.824219 0-30.164063zm0 0"/></svg>
      </div>
      Logout
    </a>
  </div>
</div>

<!-- W I D E   N A V I G A T I O N -->
<div class="widenav">
  <div class="widenav-brand">
    <h2 class="widenav-brand--title-coding">Coding Lab</h2>
    <div class="profile-container">
      <img src="{{ profile.photo.url }}" alt="" class="profile-photo">
      <div class="profile-text-container">
        <p class="profile-username">{{ profile.user.username }}</p>
        <p class="profile-role">
          {% if profile.role == 'I' %}
            Instructor
          {% else %}
            Student
          {% endif %}
        </p>
      </div>
    </div>
  </div>
  <div class="widenav-links">
    <div class="widenav-link">
      <a href="{% url 'classes' %}">Class home</a>
    </div>
    <div class="widenav-link active">
      <a href="#">My Tutorials</a>
    </div>
  </div>
</div>

<!-- C O N T E N T -->
<div class="content">
  <nav class="content--nav">
    <h1 class="content--nav-title">Tutorial Directory</h1>
  </nav>

  <div class="content--content">
    {% for tutorial in tutorials %}
    <div class="tutorial-card">
      <div class="tutorial-card--img">
        <img src="https://miro.medium.com/max/3600/1*6ahbWjp_g9hqhaTDSJOL1Q.png" alt="">
      </div>
      <div class="tutorial-card--content">
        <p class="tutorial-card--title">{{ tutorial.title }}</p>
        <div class="tutorial-card--btns">
          <div>
            <a href="{% url 'tutorial_statistics' class_id=request.resolver_match.kwargs.class_id tutorial_id=tutorial.id %}" class="tutorial-card--btn" style="margin-left: 0;">Statistics</a>            
          </div>
          <div style="display: flex;">
            <button
              onclick="assign(event)"
              data-tutorial-id="{{ tutorial.id }}"
              class="tutorial-card--btn">Assign</button>
            <a
              class="tutorial-card--btn"
              href="{% url 'editor' class_id=request.resolver_match.kwargs.class_id tutorial_id=tutorial.id %}">
              Edit
            </a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="create-btns">
    <button id="create-btn" onclick="createTutorial('lesson')">Create Lessons</button>
    <button id="create-btn" onclick="createTutorial('exercise')">Create Exercises</button>
  </div>
</div>

<!-- P O P U P S -->
<div class="assign-popup" id="assign-popup">

</div>

<div class="create-popup" id="create-popup">
  <p class="popup-title">Create Tutorial</p>
  <form action="" method="post">
    <label for="{{ tutorial_form.title.id_for_label }}">Title</label>
    {{ tutorial_form.title }}
    {{ tutorial_form.tutorial_type }}
    {% csrf_token %}
    <div class="popup-btns">
      <button class="popup-cancel-btn" onclick="closeCreatePopup()">Cancel</button>
      <input class="popup-submit-btn" type="submit" value="Create">
    </div>
  </form>
</div>

<script type="text/javascript">
function createTutorial(type) {
  document.getElementById('create-popup').style.display = 'block';
  if (type === 'lesson')
    document.getElementById('tutorial-type--input').value = 'LS'
  else
    document.getElementById('tutorial-type--input').value = 'EX'
}

function closeCreatePopup() {
  document.getElementById('create-popup').style.display = 'none';
}

function assign(e) {
  var tutorialId = e.currentTarget.dataset.tutorialId;
  var classId = '{{ request.resolver_match.kwargs.class_id }}';
  var url = '/class/' + classId + '/tutorial/' + tutorialId + '/assignment_status/';
  var adyAssignedStudents = []
  var notAssignedStudents = []
  
  fetch(url)
    .then(res => res.json())
    .then(data => {
      console.log(data);
      for (var i = 0; i < data.length; i++) {
        if (data[i].status) {
          adyAssignedStudents.push(data[i])
        } else {
          notAssignedStudents.push(data[i])
        }
      }

      var checkboxesHtml = '';
      for (var i = 0; i < notAssignedStudents.length; i++) {
        var html = `
          <div class="checkbox-container">
            <input type="checkbox" id="stud-${i + 1}" name="assigned_student" value="${notAssignedStudents[i].id}">
            <label for="stud-${i+1}">${notAssignedStudents[i].name}</label><br>
          </div>
        `
        checkboxesHtml += html;
      }

      var studentListHtml = '';
      for (var i = 0; i < adyAssignedStudents.length; i++) {
        var html = `<li>${adyAssignedStudents[i].name}</li>`;
        studentListHtml += html;
      }

      var studentAdyAssignedHtmlTitle = ''
      if (studentListHtml === '')
        studentAdyAssignedHtmlTitle = 'No students are assigned with this tutorial yet.';
      else
        studentAdyAssignedHtmlTitle = 'These students are already assigned with this tutorial:';

      var postUrl = `/assign/${classId}/${tutorialId}/`;

      var assignFormHtml = `
        <p class="assign-form-title">Assign to students:</p>
        <div>
          <button onclick="assignSelectAll()" class="selectall-btn">Select all</button>
        </div>
        <form method="post" id="assign-form" action="${postUrl}">      
          {% csrf_token %}
          ${checkboxesHtml}<br>
          <div class="assign-form--bottom-btns">
            <button onclick="closeAssignForm(event)" class="assign-cancel-btn" id="assign-cancel-btn">Cancel</button>
            <input type="submit" value="Confirm" class="assign-submit-btn" />      
          </div>
        </form>
        <p>${studentAdyAssignedHtmlTitle}</p>
        <ul>${studentListHtml}</ul>`;
      
      var assignPopup = document.getElementById('assign-popup');
      assignPopup.innerHTML = assignFormHtml;
      assignPopup.style.display = 'block';
    });
}

function closeAssignForm(e) {
  e.preventDefault();
  document.getElementById('assign-popup').style.display = 'none';
}

function assignSelectAll() {
  var students = document.getElementsByName('assigned_student');
  for (var i = 0; i < students.length; i++) {
    students[i].checked = 'checked';
  }
}

</script>
</body>