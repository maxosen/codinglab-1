{% load static %}

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coding Lab | Exercise</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="{% static 'css/layout.css' %}">
  <link rel="stylesheet" href="{% static 'css/editor.css' %}">
  <link rel="stylesheet" href="{% static 'vendor/prism.css' %}">
  
  <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
</head>
<body>

  <!-- S I D E   N A V I G A T I O N -->
<div class="sidenav">
  <div class="sidenav-link">
    <a href="{% url 'account' %}">
      <div class="navi-icon">
        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"></path></svg>
      </div>
      Account
    </a>
  </div>

  <div class="sidenav-link active">
    <a href="{% url 'classes' %}">
      <div class="navi-icon"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M208 352c-2.39 0-4.78.35-7.06 1.09C187.98 357.3 174.35 360 160 360c-14.35 0-27.98-2.7-40.95-6.91-2.28-.74-4.66-1.09-7.05-1.09C49.94 352-.33 402.48 0 464.62.14 490.88 21.73 512 48 512h224c26.27 0 47.86-21.12 48-47.38.33-62.14-49.94-112.62-112-112.62zm-48-32c53.02 0 96-42.98 96-96s-42.98-96-96-96-96 42.98-96 96 42.98 96 96 96zM592 0H208c-26.47 0-48 22.25-48 49.59V96c23.42 0 45.1 6.78 64 17.8V64h352v288h-64v-64H384v64h-76.24c19.1 16.69 33.12 38.73 39.69 64H592c26.47 0 48-22.25 48-49.59V49.59C640 22.25 618.47 0 592 0z"></path></svg></div>
      My Classes
    </a>
  </div>

  
  <div class="sidenav-link">
    <a href="{% url 'logout' %}">
      <div class="navi-icon">
        <svg height="1em" width="1em" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512.00533 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m320 277.335938c-11.796875 0-21.332031 9.558593-21.332031 21.332031v85.335937c0 11.753906-9.558594 21.332032-21.335938 21.332032h-64v-320c0-18.21875-11.605469-34.496094-29.054687-40.554688l-6.316406-2.113281h99.371093c11.777344 0 21.335938 9.578125 21.335938 21.335937v64c0 11.773438 9.535156 21.332032 21.332031 21.332032s21.332031-9.558594 21.332031-21.332032v-64c0-35.285156-28.714843-63.99999975-64-63.99999975h-229.332031c-.8125 0-1.492188.36328175-2.28125.46874975-1.027344-.085937-2.007812-.46874975-3.050781-.46874975-23.53125 0-42.667969 19.13281275-42.667969 42.66406275v384c0 18.21875 11.605469 34.496093 29.054688 40.554687l128.386718 42.796875c4.351563 1.34375 8.679688 1.984375 13.226563 1.984375 23.53125 0 42.664062-19.136718 42.664062-42.667968v-21.332032h64c35.285157 0 64-28.714844 64-64v-85.335937c0-11.773438-9.535156-21.332031-21.332031-21.332031zm0 0"/><path d="m505.75 198.253906-85.335938-85.332031c-6.097656-6.101563-15.273437-7.9375-23.25-4.632813-7.957031 3.308594-13.164062 11.09375-13.164062 19.714844v64h-85.332031c-11.777344 0-21.335938 9.554688-21.335938 21.332032 0 11.777343 9.558594 21.332031 21.335938 21.332031h85.332031v64c0 8.621093 5.207031 16.40625 13.164062 19.714843 7.976563 3.304688 17.152344 1.46875 23.25-4.628906l85.335938-85.335937c8.339844-8.339844 8.339844-21.824219 0-30.164063zm0 0"/></svg>
      </div>
      Logout
    </a>
  </div>
</div>

<!-- W I D E   N A V I G A T I O N -->
<div class="widenav">
  <div class="widenav-brand">
    <h2 class="widenav-brand--title-coding">Coding Lab</h2>
    <div class="profile-container">
      <img src="{{ profile.photo.url }}" alt="" class="profile-photo">
      <div class="profile-text-container">
        <p class="profile-username">{{ profile.user.username }}</p>
        <p class="profile-role">Instructor</p>
      </div>
    </div>
  </div>
  <div class="widenav-links">
    <div class="widenav-link">
      <a href="#">Class home</a>
    </div>
    <div class="widenav-link active">
      <a href="#">Editor</a>
    </div>
  </div>
</div>

<!-- C O N T E N T -->
<div class="content">
  <nav class="content--nav">
    <h1 class="content--nav-title">Tutorial Editor: Lesson</h1>
  </nav>

  <div class="content--content">
    <!-- lessons sidebar -->
    <div class="lessons-sidebar">
      <a class="sidebar-create-btn" href="{% url 'editor' class_id=request.resolver_match.kwargs.class_id tutorial_id=request.resolver_match.kwargs.tutorial_id %}">
        {% if form.get_form_type == 'LessonForm' %}
          Create New Lesson
        {% else %}
          Create New Exercise
        {% endif %}
      </a>
      {% for material in materials %}
      <div class="edit-link {% if request.GET.content_id|slugify == material.id|slugify %}active{% endif %}">
        <a href="{% url 'editor' class_id=request.resolver_match.kwargs.class_id tutorial_id=request.resolver_match.kwargs.tutorial_id %}?content_id={{ material.id }}">
          <p>{{ material.title }}</p>
        </a>
      </div>
      {% endfor %}
    </div>

    <!-- lessons editor -->
    {% if form.get_form_type == 'LessonForm' %}
      <div class="lessons-editor">
        <div class="content-editor--container">
          {{ form.non_field_errors }}
          <form action="" method="post" class="editor-form" id="lesson-form">
            {% csrf_token %}
            <div class="field-container">
              <label for="{{ form.title.id_for_label }}">Title</label>
              {{ form.title }}
            </div>
            <div class="field-container">
              <label for="{{ form.order.id_for_label }}">Order</label>
              {{ form.order }}
            </div>
            <label class="content-label" for="{{ form.markdown.id_for_label }}">Content</label>
            <div class="toggler-dashboard">
              <p id="toggler-state">Editing</p>
              <button id="editor-toggler">Toggle Edit</button>
            </div>
            <div id="editor-container">
              {{ form.markdown }}
            </div>
            <div id="html-container" style="display: none;"></div>
            <div class="exercise-editor--container">
              <div class="field-container">
                <label for="{{ form.exercise_question.id_for_label }}">Question</label>
                {{ form.exercise_question }}
              </div>
              <div class="field-container">
                <label for="{{ form.exercise_ans.id_for_label }}">Answer</label>
                {{ form.exercise_ans }}
              </div>
            </div>
            {% if request.GET.content_id != None %}
              <input type="hidden" name="content_id" value="{{ request.GET.content_id }}">
            {% endif %}
            <input type="hidden" name="tutorial_type" value="LS">
            <button id="lesson-submit" class="editor-submit">
              {% if request.GET.content_id == None %}
                Create
              {% else %}
                Update
              {% endif %}
            </button>
            <!--
            <input type="submit" value="Create" class="editor-submit" id="lesson-submit">
            -->
          </form>
        </div>
      </div>
    {% elif form.get_form_type == 'ExerciseForm' %}
      <div class="lessons-editor">
        <div class="content-editor--container">
          {{ form.non_field_errors }}
          <form action="" method="post" class="editor-form" id="lesson-form">
            {% csrf_token %}
            <div class="field-container">
              <label for="{{ form.title.id_for_label }}">Title</label>
              {{ form.title }}
            </div>
            <div class="field-container">
              <label for="{{ form.order.id_for_label }}">Order</label>
              {{ form.order }}
            </div>
            <label class="content-label" for="{{ form.markdown.id_for_label }}">Content</label>
            <div class="toggler-dashboard">
              <p id="toggler-state">Editing</p>
              <button id="editor-toggler">Toggle Edit</button>
            </div>
            <div id="editor-container">
              {{ form.question }}
            </div>
            <div id="html-container" style="display: none;"></div>
            <div class="exercise-editor--container">
              <div class="field-container">
                <label for="{{ form.testcases.id_for_label }}">Testcases</label>
                {{ form.testcases }}
              </div>
            </div>
            {% if request.GET.content_id != None %}
              <input type="hidden" name="content_id" value="{{ request.GET.content_id }}">
            {% endif %}
            <input type="hidden" name="tutorial_type" value="EX">
            <button id="lesson-submit" class="editor-submit">
              {% if request.GET.content_id == None %}
                Create
              {% else %}
                Update
              {% endif %}
            </button>
            <!--
            <input type="submit" value="Create" class="editor-submit" id="lesson-submit">
            -->
          </form>
        </div>
      </div>
    {% endif %}
  </div>
</div>



<script src="{% static 'vendor/prism.js' %}"></script>
<script type="text/javascript">
(function() {
  var state = false;
  var id = "editor";
  var md = "Outside the editor I am **HTML**.   \nAnd inside the editor you see me in **markdown**.   \nMake some edits and again click the button to see the changes as HTML. Wow!";
  var simplemde = new SimpleMDE({
    element: document.getElementById(id),
    initialValue: md
  });
  var html = simplemde.options.previewRender(md);
  var htmlContainer = document.getElementById('html-container');
  var editorContainer = document.getElementById('editor-container');
  var toggleBtn = document.getElementById('editor-toggler');
  var toggleState = document.getElementById('toggler-state');
  
  htmlContainer.innerHTML = html;

  // initialize markdown input with the data
  simplemde.value(document.getElementById('editor').value);

  toggleBtn.onclick = function() {
    if (state) {
      toggleState.textContent = "Previewing";
      editorContainer.style.display = 'none';
      htmlContainer.innerHTML = simplemde.options.previewRender(simplemde.value());
      htmlContainer.style.display = 'block';
    } else {
      toggleState.textContent = "Editing";
      editorContainer.style.display = 'inline';
      simplemde.codemirror.refresh();
      htmlContainer.innerHTML = '';
      htmlContainer.style.display = 'none';
    }
    state = !state;
  }


  document.getElementById('lesson-submit').addEventListener('click', function(e) {
    if (e.preventDefault) e.preventDefault();
    document.getElementById('editor').value = simplemde.value();
    console.log(document.getElementById('editor').value);
    console.log(simplemde.value());
    document.getElementById('lesson-form').submit();
  });


})();

</script>
</body>