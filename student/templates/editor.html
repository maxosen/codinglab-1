{% load static %}

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coding Lab | Exercise</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="{% static 'css/layout.css' %}">
  <link rel="stylesheet" href="{% static 'css/editor.css' %}">
  <link rel="stylesheet" href="{% static 'vendor/prism.css' %}">
  
  <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
</head>
<body>

  <!-- S I D E   N A V I G A T I O N -->
<div class="sidenav">
  <div class="sidenav-link">
    <div class="navi-icon">
      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"></path></svg>
    </div>
    <a href="#">Account</a>
  </div>

  <div class="sidenav-link active">
    <div class="navi-icon"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M208 352c-2.39 0-4.78.35-7.06 1.09C187.98 357.3 174.35 360 160 360c-14.35 0-27.98-2.7-40.95-6.91-2.28-.74-4.66-1.09-7.05-1.09C49.94 352-.33 402.48 0 464.62.14 490.88 21.73 512 48 512h224c26.27 0 47.86-21.12 48-47.38.33-62.14-49.94-112.62-112-112.62zm-48-32c53.02 0 96-42.98 96-96s-42.98-96-96-96-96 42.98-96 96 42.98 96 96 96zM592 0H208c-26.47 0-48 22.25-48 49.59V96c23.42 0 45.1 6.78 64 17.8V64h352v288h-64v-64H384v64h-76.24c19.1 16.69 33.12 38.73 39.69 64H592c26.47 0 48-22.25 48-49.59V49.59C640 22.25 618.47 0 592 0z"></path></svg></div>
    <a href="#">My Classes</a>
  </div>

  <div class="sidenav-link">
    <div class="navi-icon"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z" clip-rule="evenodd"></path></svg></div>
    <a href="#">Notifications</a>
  </div>

  <div class="sidenav-link">
    <div class="navi-icon">
      <svg width="30" height="30" fill="white" stroke-width="0" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg"><path d=" M 650 75C 705 75 750 120 750 175C 750 175 750 875 750 875C 750 896 739 915 721 925C 704 934 681 933 662 921C 662 921 537 846 537 846C 518 835 507 831 500 831C 493 831 482 835 463 846C 463 846 338 921 338 921C 319 933 296 934 279 925C 261 915 250 896 250 875C 250 875 250 175 250 175C 250 120 295 75 350 75C 350 75 650 75 650 75"/></svg>
    </div>
    <a href="#">Bookmarks</a>
  </div>
</div>

<!-- W I D E   N A V I G A T I O N -->
<div class="widenav">
  <div class="widenav-brand">
    <h2 class="widenav-brand--title-coding">Coding Lab</h2>
  </div>
  <div class="widenav-links">
    <div class="widenav-link">
      <a href="#">Class home</a>
    </div>
    <div class="widenav-link active">
      <a href="#">Editor</a>
    </div>
  </div>
</div>

<!-- C O N T E N T -->
<div class="content">
  <nav class="content--nav">
    <h1 class="content--nav-title">Tutorial Editor: Lesson</h1>
    <div class="breadcrumb">
      <p class="breadcrumb-link">Tutorial 1</p>
      <div class="breadcrumb-separator">/</div>
      <p class="breadcrumb-link">Tutorial 2</p>
    </div>
  </nav>

  <div class="content--content">
    <!-- lessons sidebar -->
    <div class="lessons-sidebar">
      <a class="sidebar-create-btn" href="{% url 'editor' class_id=request.resolver_match.kwargs.class_id tutorial_id=request.resolver_match.kwargs.tutorial_id %}">
        {% if form.get_form_type == 'LessonForm' %}
          Create New Lesson
        {% else %}
          Create New Exercise
        {% endif %}
      </a>
      {% for material in materials %}
      <div class="edit-link {% if request.GET.content_id|slugify == material.id|slugify %}active{% endif %}">
        <a href="{% url 'editor' class_id=request.resolver_match.kwargs.class_id tutorial_id=request.resolver_match.kwargs.tutorial_id %}?content_id={{ material.id }}">
          <p>{{ material.title }}</p>
        </a>
      </div>
      {% endfor %}
    </div>

    <!-- lessons editor -->
    {% if form.get_form_type == 'LessonForm' %}
      <div class="lessons-editor">
        <div class="content-editor--container">
          {{ form.non_field_errors }}
          <form action="" method="post" class="editor-form" id="lesson-form">
            {% csrf_token %}
            <div class="field-container">
              <label for="{{ form.title.id_for_label }}">Title</label>
              {{ form.title }}
            </div>
            <div class="field-container">
              <label for="{{ form.order.id_for_label }}">Order</label>
              {{ form.order }}
            </div>
            <label class="content-label" for="{{ form.markdown.id_for_label }}">Content</label>
            <div class="toggler-dashboard">
              <p id="toggler-state">Editing</p>
              <button id="editor-toggler">Toggle Edit</button>
            </div>
            <div id="editor-container">
              {{ form.markdown }}
            </div>
            <div id="html-container" style="display: none;"></div>
            <div class="exercise-editor--container">
              <div class="field-container">
                <label for="{{ form.exercise_question.id_for_label }}">Question</label>
                {{ form.exercise_question }}
              </div>
              <div class="field-container">
                <label for="{{ form.exercise_ans.id_for_label }}">Answer</label>
                {{ form.exercise_ans }}
              </div>
            </div>
            {% if request.GET.content_id != None %}
              <input type="hidden" name="content_id" value="{{ request.GET.content_id }}">
            {% endif %}
            <input type="hidden" name="tutorial_type" value="LS">
            <button id="lesson-submit" class="editor-submit">
              {% if request.GET.content_id == None %}
                Create
              {% else %}
                Update
              {% endif %}
            </button>
            <!--
            <input type="submit" value="Create" class="editor-submit" id="lesson-submit">
            -->
          </form>
        </div>
      </div>
    {% elif form.get_form_type == 'ExerciseForm' %}
      <div class="lessons-editor">
        <div class="content-editor--container">
          {{ form.non_field_errors }}
          <form action="" method="post" class="editor-form" id="lesson-form">
            {% csrf_token %}
            <div class="field-container">
              <label for="{{ form.title.id_for_label }}">Title</label>
              {{ form.title }}
            </div>
            <div class="field-container">
              <label for="{{ form.order.id_for_label }}">Order</label>
              {{ form.order }}
            </div>
            <label class="content-label" for="{{ form.markdown.id_for_label }}">Content</label>
            <div class="toggler-dashboard">
              <p id="toggler-state">Editing</p>
              <button id="editor-toggler">Toggle Edit</button>
            </div>
            <div id="editor-container">
              {{ form.question }}
            </div>
            <div id="html-container" style="display: none;"></div>
            <div class="exercise-editor--container">
              <div class="field-container">
                <label for="{{ form.testcases.id_for_label }}">Testcases</label>
                {{ form.testcases }}
              </div>
            </div>
            {% if request.GET.content_id != None %}
              <input type="hidden" name="content_id" value="{{ request.GET.content_id }}">
            {% endif %}
            <input type="hidden" name="tutorial_type" value="EX">
            <button id="lesson-submit" class="editor-submit">
              {% if request.GET.content_id == None %}
                Create
              {% else %}
                Update
              {% endif %}
            </button>
            <!--
            <input type="submit" value="Create" class="editor-submit" id="lesson-submit">
            -->
          </form>
        </div>
      </div>
    {% endif %}
  </div>
</div>



<script src="{% static 'vendor/prism.js' %}"></script>
<script type="text/javascript">
(function() {
  var state = false;
  var id = "editor";
  var md = "Outside the editor I am **HTML**.   \nAnd inside the editor you see me in **markdown**.   \nMake some edits and again click the button to see the changes as HTML. Wow!";
  var simplemde = new SimpleMDE({
    element: document.getElementById(id),
    initialValue: md
  });
  var html = simplemde.options.previewRender(md);
  var htmlContainer = document.getElementById('html-container');
  var editorContainer = document.getElementById('editor-container');
  var toggleBtn = document.getElementById('editor-toggler');
  var toggleState = document.getElementById('toggler-state');
  
  htmlContainer.innerHTML = html;

  // initialize markdown input with the data
  simplemde.value(document.getElementById('editor').value);

  toggleBtn.onclick = function() {
    if (state) {
      toggleState.textContent = "Previewing";
      editorContainer.style.display = 'none';
      htmlContainer.innerHTML = simplemde.options.previewRender(simplemde.value());
      htmlContainer.style.display = 'block';
    } else {
      toggleState.textContent = "Editing";
      editorContainer.style.display = 'inline';
      simplemde.codemirror.refresh();
      htmlContainer.innerHTML = '';
      htmlContainer.style.display = 'none';
    }
    state = !state;
  }


  document.getElementById('lesson-submit').addEventListener('click', function(e) {
    if (e.preventDefault) e.preventDefault();
    document.getElementById('editor').value = simplemde.value();
    console.log(document.getElementById('editor').value);
    console.log(simplemde.value());
    document.getElementById('lesson-form').submit();
  });


})();

</script>
</body>